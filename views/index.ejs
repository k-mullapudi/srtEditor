<!DOCTYPE html>
<html>
<head>
    <link href="https://vjs.zencdn.net/7.2.3/video-js.css" rel="stylesheet">

    <!-- If you'd like to support IE8 (for Video.js versions prior to v7) -->
    <!--<script src="https://vjs.zencdn.net/ie8/ie8-version/videojs-ie8.min.js"></script>-->

    <!-- jQuery cdn -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous">
    </script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous">
    </script>
</head>

<body>
<nav class="navbar navbar-default"> </nav>

<div class="container">
    <div class="col-lg-7 centered">
        <div class="row" style="margin-top: 20px">

            <video id="video_player" class="video-js" controls preload="none" width="640" height="360"
                   poster="http://d2zihajmogu5jn.cloudfront.net/elephantsdream/poster.png">

                <source src="//d2zihajmogu5jn.cloudfront.net/elephantsdream/ed_hd.mp4" type="video/mp4">
                <source src="//d2zihajmogu5jn.cloudfront.net/elephantsdream/ed_hd.ogg" type="video/ogg">

                <p class="vjs-no-js">To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a></p>
            </video>
        </div>

        <div class="row" style="margin-top: 20px">
            <div class="panel panel-default">
                <div class="panel-heading" id="original_caption_header">Original Caption</div>
                <div class="panel-body" id="original_caption">
                    <%= text %>
                </div>
            </div>

            <form class="form">
                <div class="form-group mx-sm-3 mb-2">
                    <label for="edit_caption" class="sr-only">Current Subtitle</label>
                    <input type="text" class="form-control" id="edit_caption" placeholder="Subtitle">
                </div>
                <button id="doParse" type="submit" class="btn btn-primary mb-2">Update Subtitle</button>
            </form>
        </div>

    </div>

    <div class="col-lg-5">
        <p> Subtitles </p>

        <div class="list-group" id="subtitle_list">

        </div>
    </div>

</div>

<script src="https://vjs.zencdn.net/7.2.3/video.js"></script>
<script>
    let player = videojs('video_player');
    console.log(player.duration());
</script>

<script>
    function loadData(caption) {
        document.getElementById("original_caption").innerHTML = caption.text;
        document.getElementById("original_caption_header").innerHTML = caption.startTime + " --> " + caption.endTime;
        document.getElementById("edit_caption").innerHTML = "CLICKED!";
    }
</script>

<script>
    /* https://stackoverflow.com/questions/33145762/parse-a-srt-file-with-jquery-javascript/33147421 */
    var PF_SRT = function() {
        var pattern = /(\d+)\n([\d:,]+)\s+-{2}\>\s+([\d:,]+)\n([\s\S]*?(?=\n{2}|$))/gm;
        var _regExp;

        var init = function() {
            _regExp = new RegExp(pattern);
        };
        var parse = function(f) {
            if (typeof(f) !== "string")
                throw "Sorry, Parser accept string only.";

            var result = [];
            if (f == null)
                return _subtitles;

            f = f.replace(/\r\n|\r|\n/g, '\n')

            while ((matches = pattern.exec(f)) != null) {
                result.push(toLineObj(matches));
            }
            return result;
        }
        var toLineObj = function(group) {
            return {
                line: group[1],
                startTime: group[2],
                endTime: group[3],
                text: group[4]
            };
        }
        init();
        return {
            parse: parse
        }
    }();

    $(function() {
        $("#doParse").on('click', function() {
            try {
                var text = $("#source").val();
                var result = PF_SRT.parse(text);
                var wrapper = $("#subtitle_list");
                wrapper.html('');
                for (var line in result) {
                    var obj = result[line];
                    wrapper.append(
                        "<a class='list-group-item list-group-item-action flex-column align-items-start'>"
                        + "<div class='d-flex w-100 justify-content-between'>" +
                        + "<small>" + obj.line + "</small>"
                        + "</div>"
                        + "<p class=\"mb-1\">" + obj.text + "</p>"
                        + "<small>" + obj.startTime + " --> " + obj.endTime + "</small>"
                        + "</a>"
                    );
                }
            } catch (e) {
                alert(e);
            }
        });
    });
</script>
</body>
</html>